<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>My Cloud Diary</title>
<style>
body {
  font-family: Arial;
  background: #111;
  color: white;
  text-align: center;
  padding: 15px;
}
input, textarea, button {
  width: 95%;
  padding: 12px;
  margin: 6px;
  font-size: 16px;
}
.entry {
  background: #222;
  padding: 10px;
  margin: 10px;
  border-radius: 8px;
  text-align: left;
}
.entry button {
  padding: 4px 6px;
  font-size: 12px;
  margin-left: 4px;
  float: right;
}
.hidden { display: none; }
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
  getFirestore, 
  collection, 
  addDoc, 
  getDocs, 
  query, 
  orderBy, 
  doc, 
  deleteDoc, 
  updateDoc 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// ---------- FIREBASE ----------
const firebaseConfig = {
  apiKey: "AIzaSyA8hfYjGN1EgB7K8x77p_ky84ssuWS8EkI",
  authDomain: "my-diary-app-ee165.firebaseapp.com",
  projectId: "my-diary-app-ee165"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ---------- LOGIN ----------
const USER = "yusufsodiq082@gmail.com";
const PASS = "a336336a";

window.addEventListener("DOMContentLoaded", ()=>{
  const email = document.getElementById("email");
  const password = document.getElementById("password");
  const loginBtn = document.getElementById("loginBtn");
  const loginBox = document.getElementById("loginBox");
  const diary = document.getElementById("diary");
  const title = document.getElementById("title");
  const msg = document.getElementById("msg");
  const text = document.getElementById("text");
  const saveBtn = document.getElementById("saveBtn");
  const entriesDiv = document.getElementById("entries");
  const searchInput = document.getElementById("search");

  // ---------- LOGIN ----------
  loginBtn.onclick = ()=>{
    if(email.value === USER && password.value === PASS){
      loginBox.classList.add("hidden");
      diary.classList.remove("hidden");
      title.innerText = "ğŸ“” My Diary";
      loadEntries();
    } else {
      msg.innerText = "âŒ Incorrect login or password";
    }
  };

  // ---------- SAVE ----------
  saveBtn.onclick = async ()=>{
    const txt = text.value.trim();
    if(!txt) return alert("Write something!");
    await addDoc(collection(db,"diary"),{
      text: txt,
      time: Date.now()
    });
    text.value="";
    loadEntries();
  };

  // ---------- LOAD ----------
  async function loadEntries(){
    entriesDiv.innerHTML = "";
    const q = query(collection(db,"diary"), orderBy("time","desc"));
    const snapshot = await getDocs(q);
    snapshot.forEach(docSnap=>{
      const d = docSnap.data();
      const div = document.createElement("div");
      div.className="entry";

      div.innerHTML = `
        <b>${new Date(d.time).toLocaleString()}</b><br>
        <span class="entry-text">${d.text}</span>
        <div style="text-align: right; margin-top: 5px;">
          <button class="editBtn">âœï¸</button>
          <button class="delBtn">ğŸ—‘ï¸</button>
        </div>
      `;

      entriesDiv.appendChild(div);

      // ---------- DELETE ----------
      div.querySelector(".delBtn").onclick = async ()=>{
        if(confirm("Delete this entry?")){
          await deleteDoc(doc(db,"diary",docSnap.id));
          loadEntries();
        }
      };

      // ---------- EDIT ----------
      div.querySelector(".editBtn").onclick = async ()=>{
        const newText = prompt("Edit your entry:", d.text);
        if(newText !== null){
          await updateDoc(doc(db,"diary",docSnap.id), { text: newText });
          loadEntries();
        }
      };
    });
  }

  // ---------- SEARCH ----------
  searchInput.oninput = ()=>{
    const queryText = searchInput.value.toLowerCase();
    document.querySelectorAll(".entry").forEach(e=>{
      const txt = e.querySelector(".entry-text").innerText.toLowerCase();
      e.style.display = txt.includes(queryText) ? "" : "none";
    });
  };
});
</script>
</head>
<body>

<h2 id="title">ğŸ” Login</h2>

<div id="loginBox">
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button id="loginBtn">Login</button>
  <p id="msg"></p>
</div>

<div id="diary" class="hidden">
  <textarea id="text" placeholder="Write your thoughts..."></textarea>
  <button id="saveBtn">â• Save</button>
  <input id="search" placeholder="Search entries...">
  <div id="entries"></div>
</div>

</body>
</html>
