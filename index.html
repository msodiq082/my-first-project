<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>My Cloud Diary</title>
<style>
body {
  font-family: Arial;
  background: #111;
  color: white;
  text-align: center;
  padding: 15px;
}
input, textarea, button {
  width: 95%;
  padding: 12px;
  margin: 6px;
  font-size: 16px;
}
.entry {
  background: #222;
  padding: 10px;
  margin: 10px;
  border-radius: 8px;
  text-align: left;
}
.hidden { display: none; }
</style>
<script type="module">
  // ---------- FIREBASE ----------
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA8hfYjGN1EgB7K8x77p_ky84ssuWS8EkI",
    authDomain: "my-diary-app-ee165.firebaseapp.com",
    projectId: "my-diary-app-ee165"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ---------- LOGIN ----------
  const USER = "yusufsodiq082@gmail.com";
  const PASS = "a336336a";

  window.addEventListener("DOMContentLoaded", ()=>{
    const email = document.getElementById("email");
    const password = document.getElementById("password");
    const loginBtn = document.getElementById("loginBtn");
    const loginBox = document.getElementById("loginBox");
    const diary = document.getElementById("diary");
    const title = document.getElementById("title");
    const msg = document.getElementById("msg");
    const text = document.getElementById("text");
    const saveBtn = document.getElementById("saveBtn");
    const entriesDiv = document.getElementById("entries");

    loginBtn.onclick = ()=>{
      if(email.value === USER && password.value === PASS){
        loginBox.classList.add("hidden");
        diary.classList.remove("hidden");
        title.innerText = "üìî My Diary";
        loadEntries();
      } else {
        msg.innerText = "‚ùå Incorrect login or password";
      }
    };

    // ---------- SAVE ENTRY ----------
    saveBtn.onclick = async ()=>{
      const txt = text.value.trim();
      if(!txt) return alert("Write something!");
      try {
        await addDoc(collection(db,"diary"),{
          text: txt,
          time: new Date().toLocaleString()
        });
        text.value = "";
        loadEntries();
      } catch(e){
        alert("Error saving: " + e.message);
      }
    };

    // ---------- LOAD ENTRIES ----------
    async function loadEntries(){
      entriesDiv.innerHTML = "";
      const q = query(collection(db,"diary"), orderBy("time","desc"));
      const snapshot = await getDocs(q);
      snapshot.forEach(doc=>{
        const d = doc.data();
        const div = document.createElement("div");
        div.className="entry";
        div.innerHTML = `<b>${d.time}</b><br>${d.text}`;
        entriesDiv.appendChild(div);
      });
    }
  });
</script>
</head>
<body>

<h2 id="title">üîê Login</h2>

<div id="loginBox">
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button id="loginBtn">Login</button>
  <p id="msg"></p>
</div>

<div id="diary" class="hidden">
  <textarea id="text" placeholder="Write your thoughts..."></textarea>
  <button id="saveBtn">‚ûï Save</button>
  <div id="entries"></div>
</div>

</body>
</html>
