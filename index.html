<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Private Cloud Diary</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#111;color:white;text-align:center;padding:20px;}
input,textarea,button{font-size:16px;padding:8px;margin:5px;width:90%;}
.note{background:#222;padding:10px;margin:10px;border-radius:6px;}
small{color:#aaa;}
button{cursor:pointer;}
.hidden{display:none;}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginBox">
<h2>ğŸ” Login</h2>
<input id="email" placeholder="Email"><br>
<input id="password" type="password" placeholder="Password"><br>
<button onclick="login()">Login</button>
<p id="msg"></p>
</div>

<!-- DIARY -->
<div id="diaryBox" class="hidden">
<h2>ğŸ“” My Private Diary</h2>
<textarea id="text" placeholder="Write your thoughts..."></textarea><br>
<button onclick="save()">â• Add</button>
<button onclick="logout()">ğŸšª Logout</button>
<div id="notes"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA8hfYjGN1EgB7K8x77p_ky84ssuWS8EkI",
  authDomain: "my-diary-app-ee165.firebaseapp.com",
  projectId: "my-diary-app-ee165",
  storageBucket: "my-diary-app-ee165.firebasestorage.app",
  messagingSenderId: "754565123662",
  appId: "1:754565123662:web:6862a02f691ad2b453bd1f"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const diaryRef = collection(db, "diary");

// LOGIN
window.login = function(){
  const email = document.getElementById("email").value;
  const pass = document.getElementById("password").value;

  if(email === "yusufsodiq082@gmail.com" && pass === "a336336a"){
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("diaryBox").classList.remove("hidden");
    load();
  } else {
    document.getElementById("msg").innerText = "âŒ Incorrect login or password";
  }
}

window.logout = function(){
  location.reload();
}

// ADD
window.save = async function(){
  const text = document.getElementById("text").value.trim();
  if(!text) return alert("Write something!");

  await addDoc(diaryRef, {
    text: text,
    time: new Date().toLocaleString()
  });

  document.getElementById("text").value = "";
  load();
}

// LOAD
async function load(){
  const snap = await getDocs(diaryRef);
  const notes = document.getElementById("notes");
  notes.innerHTML = "";

  snap.forEach(d=>{
    const data = d.data();
    const div = document.createElement("div");
    div.className = "note";

    div.innerHTML = `
      <small>${data.time}</small><br>
      <textarea id="t_${d.id}">${data.text}</textarea><br>
      <button onclick="updateNote('${d.id}')">âœï¸ Update</button>
      <button onclick="deleteNote('${d.id}')">ğŸ—‘ Delete</button>
    `;
    notes.appendChild(div);
  });
}

// UPDATE
window.updateNote = async function(id){
  const text = document.getElementById("t_"+id).value;
  await updateDoc(doc(db,"diary",id), { text:text });
  alert("Updated âœ…");
}

// DELETE
window.deleteNote = async function(id){
  if(confirm("Delete this note?")){
    await deleteDoc(doc(db,"diary",id));
    load();
  }
}

</script>
</body>
</html>
